{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "growth-autopilot/error-envelope",
  "title": "Typed Error Envelope",
  "description": "Typed error envelope for degraded responses and upstream failures",
  "type": "object",
  "required": ["success", "degraded", "capability_id", "error_code", "message", "retry_guidance", "timestamp"],
  "properties": {
    "success": {
      "type": "boolean",
      "const": false,
      "description": "Always false for error envelopes"
    },
    "degraded": {
      "type": "boolean",
      "const": true,
      "description": "Always true for degraded responses"
    },
    "capability_id": {
      "type": "string",
      "minLength": 1,
      "description": "Capability that failed"
    },
    "error_code": {
      "type": "string",
      "enum": ["UPSTREAM_UNAVAILABLE", "DEPENDENCY_TIMEOUT", "RATE_LIMITED", "CIRCUIT_OPEN"],
      "description": "Typed error code"
    },
    "message": {
      "type": "string",
      "description": "Human-readable error message"
    },
    "retry_guidance": {
      "type": "object",
      "required": ["retryable", "reason"],
      "properties": {
        "retryable": {
          "type": "boolean",
          "description": "Whether the operation can be retried"
        },
        "retry_after_seconds": {
          "type": "number",
          "description": "Seconds to wait before retrying"
        },
        "max_retries": {
          "type": "integer",
          "default": 3,
          "description": "Maximum retry attempts"
        },
        "strategy": {
          "type": "string",
          "enum": ["immediate", "exponential_backoff", "fixed_interval"],
          "default": "exponential_backoff",
          "description": "Retry strategy"
        },
        "reason": {
          "type": "string",
          "description": "Reason for retry guidance"
        }
      },
      "additionalProperties": false,
      "description": "Retry guidance for the failed operation"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the error"
    },
    "fallback_data": {
      "type": "object",
      "description": "Optional fallback/cached data"
    }
  },
  "additionalProperties": false
}
